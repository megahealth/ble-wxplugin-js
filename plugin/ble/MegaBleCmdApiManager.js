"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),_MegaBleConst=require("./MegaBleConst.js"),_MegaUtils=require("./MegaUtils.js"),_MegaBleCmdMaker=require("./MegaBleCmdMaker.js");function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var MegaBleCmdApiManager=function(){function t(e){_classCallCheck(this,t),this.deviceId=e}return _createClass(t,[{key:"enablePipes",value:function(){var e=this;return new Promise(function(a,n){e._enablePipe(_MegaBleConst.BLE_CFG.CH_INDICATE,!0).then(function(t){e._enablePipe(_MegaBleConst.BLE_CFG.CH_NOTIFY,!0).then(function(e){return a([t,e])}).catch(function(e){return n(e)})}).catch(function(e){return n(e)})})}},{key:"_enablePipe",value:function(e,n){var r=this;return new Promise(function(t,a){wx.notifyBLECharacteristicValueChange({deviceId:r.deviceId,serviceId:_MegaBleConst.BLE_CFG.SVC_ROOT,characteristicId:e,state:n,success:function(e){return t(e)},fail:function(e){return a(e)}})})}},{key:"bindWithoutToken",value:function(e,t){var a=(0,_MegaBleCmdMaker.makeBindMacCmd)(e,t);return console.log("[cmd] bindWithoutToken -> "+(0,_MegaUtils.u8s2hex)(a)),this._write(a)}},{key:"bindWithToken",value:function(e,t){var a=(0,_MegaBleCmdMaker.makeBindTokenCmd)(e,t);return console.log("[cmd] bindWithToken -> "+(0,_MegaUtils.u8s2hex)(a)),this._write(a)}},{key:"bindWithMasterToken",value:function(){var e=(0,_MegaBleCmdMaker.makeBindMasterCmd)();return console.log("[cmd] bindWithMasterToken -> "+(0,_MegaUtils.u8s2hex)(e)),this._write(e)}},{key:"setTime",value:function(){var e=(0,_MegaBleCmdMaker.makeSetTimeCmd)();return console.log("[cmd] setTime -> "+(0,_MegaUtils.u8s2hex)(e)),this._write(e)}},{key:"setUserInfo",value:function(e,t,a,n,r){var i=(0,_MegaBleCmdMaker.makeUserInfoCmd)(e,t,a,n,r);return console.log("[cmd] setUserInfo -> "+(0,_MegaUtils.u8s2hex)(i)),this._write(i)}},{key:"sendHeartBeat",value:function(){var e=(0,_MegaBleCmdMaker.makeHeartBeatCmd)();return console.log("[cmd] sendHeartBeat -> "+(0,_MegaUtils.u8s2hex)(e)),this._write(e)}},{key:"enableMonitorV1",value:function(e){var t=(0,_MegaBleCmdMaker.makeMonitorCmd)(e);return console.log("[cmd] enableMonitorV1 -> "+(0,_MegaUtils.u8s2hex)(t)),this._write(t)}},{key:"toggleLiveData",value:function(e){var t=(0,_MegaBleCmdMaker.makeLiveCmd)(e);return console.log("[cmd] toggleLiveData -> "+(0,_MegaUtils.u8s2hex)(t)),this._write(t)}},{key:"enableV2ModeLiveSpo",value:function(e,t){var a=(0,_MegaBleCmdMaker.makeV2EnableModeLiveSpo)(e,t);return console.log("[cmd] enableV2ModeLiveSpo -> "+(0,_MegaUtils.u8s2hex)(a)),this._write(a)}},{key:"enableV2ModeDaily",value:function(e,t){var a=(0,_MegaBleCmdMaker.makeV2EnableModeDaily)(e,t);return console.log("[cmd] enableV2ModeDaily -> "+(0,_MegaUtils.u8s2hex)(a)),this._write(a)}},{key:"enableV2ModeSpoMonitor",value:function(e,t){var a=(0,_MegaBleCmdMaker.makeV2EnableModeSpoMonitor)(e,t);return console.log("[cmd] enableV2ModeSpoMonitor -> "+(0,_MegaUtils.u8s2hex)(a)),this._write(a)}},{key:"syncMonitorData",value:function(){var e=(0,_MegaBleCmdMaker.makeSyncMonitorDataCmd)();return console.log("[cmd] syncMonitorData -> "+(0,_MegaUtils.u8s2hex)(e)),this._write(e)}},{key:"syncDailyData",value:function(){var e=(0,_MegaBleCmdMaker.makeSyncDailyDataCmd)();return console.log("[cmd] syncDailyData -> "+(0,_MegaUtils.u8s2hex)(e)),this._write(e)}},{key:"writeReportPack",value:function(e){return console.log("[cmd] writeReportPack -> "+(0,_MegaUtils.u8s2hex)(e)),this._write(e)}},{key:"readDeviceInfo",value:function(){var e=this;return new Promise(function(t,a){wx.readBLECharacteristicValue({deviceId:e.deviceId,serviceId:_MegaBleConst.BLE_CFG.SVC_ROOT,characteristicId:_MegaBleConst.BLE_CFG.CH_READ,success:function(e){return t(e)},fial:function(e){return a(e)}})})}},{key:"enableRawdata",value:function(e){var n=this;return new Promise(function(t,a){wx.notifyBLECharacteristicValueChange({deviceId:n.deviceId,serviceId:_MegaBleConst.BLE_CFG.SCV_LOG,characteristicId:_MegaBleConst.BLE_CFG.CH_LOG_NOTIFY,state:e,success:function(e){return t(e)},fail:function(e){return a(e)}})})}},{key:"startDfu",value:function(){var e=this;wx.notifyBLECharacteristicValueChange({deviceId:this.deviceId,serviceId:_MegaBleConst.BLE_CFG.SVC_DFU,characteristicId:_MegaBleConst.BLE_CFG.CH_DFU_CTRL,state:!0,success:function(){setTimeout(function(){wx.writeBLECharacteristicValue({deviceId:e.deviceId,serviceId:_MegaBleConst.BLE_CFG.SVC_DFU,characteristicId:_MegaBleConst.BLE_CFG.CH_DFU_CTRL,value:new Uint8Array([1,4]).buffer,success:function(e){return console.log(e)},fail:function(e){return console.error(e)}})},1e3)},fail:function(e){return console.error(e)}})}},{key:"_write",value:function(e){var n=this;return new Promise(function(t,a){wx.writeBLECharacteristicValue({deviceId:n.deviceId,serviceId:_MegaBleConst.BLE_CFG.SVC_ROOT,characteristicId:_MegaBleConst.BLE_CFG.CH_WRITE,value:e.buffer,success:function(e){return t(e)},fail:function(e){return a(e)}})})}}]),t}();exports.default=MegaBleCmdApiManager;